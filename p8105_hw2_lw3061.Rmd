---
title: "P8105 HW2"
author: "Lucia Wang (lw3061)"
date: "due 10-04-2023"
output: github_document
---
```{r}
library(tidyverse)
library(readxl)
```

# Problem 1

## clean data in pols-month.csv
Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.

## clean data in snp.csv 
arrange according to year and month, and organize so that year and month are the leading columns.

## tidy unemployment data
this process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

## merge snp and pols and merge unemployment into the result
Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).

# Problem 2
### Read and clean the Mr. Trash Wheel sheet.

1) specify the sheet and omit rows with notes/figures and columns with notes
```{r}
mrtrash_df = 
  read_excel("202207 Trash Wheel Collection Data.xlsx", 
             sheet="Mr. Trash Wheel", 
             range="A2:M549")
```

2) clean and update the data to include a new `homes_powered` variable. Add an additional variable to keep track of which Trash Wheel is which...
```{r}
mrtrash_df =
  janitor::clean_names(mrtrash_df) |>
  mutate(kilowatts = weight_tons * 500,
         homes_powered = kilowatts / 30,
         name = "Mr. Trash Wheel") 
```

3) repeat for Professor Trash Wheel and Gwynnda, then combine
```{r}
proftrash_df =
  read_excel("202207 Trash Wheel Collection Data.xlsx", 
             sheet="Professor Trash Wheel", 
             range="A2:L96") |>
  janitor::clean_names() |>
  mutate(kilowatts = weight_tons * 500,
         homes_powered = kilowatts / 30,
         name = "Professor Trash Wheel",
         year = as.character(year)) 

proftrash_df

gwynnda_df = 
  read_excel("202207 Trash Wheel Collection Data.xlsx", 
             sheet="Gwynnda Trash Wheel", 
             range="A2:J108") |>
  janitor::clean_names() |>
  mutate(kilowatts = weight_tons * 500,
         homes_powered = kilowatts / 30,
         name = "Gwynnda Trash Wheel",
         year = as.character(year))

gwynnda_df

trashwheels_tidy_df =
  bind_rows(mrtrash_df, proftrash_df, gwynnda_df) |>
  janitor::clean_names()

```

The final tidied dataset with all 3 trash wheels incorporated has `r ncol(trashwheels_tidy_df)` columns (variables) and `r nrow(trashwheels_tidy_df)` rows (observations). 

Key variables are `weight_tons`, `homes_powered`, `dumpster`, and `month`/`year`/`date`. Some of the most popular trash items were `cigarette_butts`, `plastic_bottles`, and `polystyrene`, but others like `sports_balls` and `plastic_bags` were also present. 

The total weight of trash collected by Professor Trash Wheel was `r sum(pull(proftrash_df, weight_tons))` tons. 

The total number of cigarette butts collected by Gwynnda in July 2021 was `r sum(pull(filter(gwynnda_df, month=="July", year=="2021"),weight_tons))` tons.


# Problem 3
### Import and clean MCI data.

1) import the data and clean names
```{r}
baseline_df = 
  read_csv("data_mci/MCI_baseline.csv", skip=1) |>
  janitor::clean_names() 
```
The data currently has `r nrow(baseline_df)` observations.

2) recode variables and remove participants who did not have an age of onset of MCI
```{r}
baseline_df = baseline_df |>
  mutate(
    sex = as.character(sex),
    sex = case_match(sex, 
                     "0" ~ "Female",
                     "1" ~ "Male"),
    apoe4 = as.character(apoe4),
    apoe4 = case_match(apoe4,
                       "0" ~ "Non-carrier",
                       "1" ~ "Carrier"),
    id = as.character(id)
        ) |>
  filter(age_at_onset!=".") 
```
The number of observations that had an age of onset for MCI was `r nrow(baseline_df)`. 

The average baseline age of this final dataset was `r round(mean(pull(baseline_df,current_age)),digits=2)` years.

The proportion of women in the study who were APOE4 carriers was `r round(nrow(filter(baseline_df, sex=="Female", apoe4=="Carrier"))/nrow(filter(baseline_df, sex=="Female")),digits=2)`.


3) import, clean, and tidy the biomarkers csv
```{r}
amyloid_df = 
  read_csv("data_mci/mci_amyloid.csv", skip=1) |>
  janitor::clean_names()
```
Before cleaning out missing time values, the total number of observations in the amyloid dataset is `r nrow(amyloid_df)`. 

```{r}
amyloid_df = amyloid_df |>
  drop_na() |>
  rename(id=study_id) |>
  mutate(
    id = as.character(id)
  )
```
After dropping missing values, the number of observations is `r nrow(amyloid_df)`.

4) see which participants appear in which datasets, and then combine them and only retain participants in both. 
```{r}
anti_combine_1 = 
  anti_join(baseline_df, amyloid_df, by="id")

anti_combine_2 = 
  anti_join(amyloid_df, baseline_df, by="id")
```
`r nrow(anti_combine_1)` participants only appeared in the baseline dataset, and `r nrow(anti_combine_2)` participants only appeared in the amyloid dataset. 

```{r}
mci_amyloid_combine = 
  inner_join(baseline_df, amyloid_df, by="id")
```
The final tidied dataset combining baseline and amyloid data only had full data for `r nrow(mci_amyloid_combine)` participants. 

The average age at baseline for this group was `r round(mean(pull(mci_amyloid_combine, current_age)), digits=2)` years, and the average age of onset for MCI was `r round(mean(pull(mci_amyloid_combine, age_at_onset)), digits=2)`. 

Of these participants, `r nrow(filter(mci_amyloid_combine, sex=="Female"))` were women.

The proportion of participants who were carriers of the APOE4 variant was `r round(nrow(filter(mci_amyloid_combine, apoe4=="Carrier")) / nrow(mci_amyloid_combine), digits=2)`. 

5) Export the data to the directory.
```{r, message=FALSE}
write_csv(mci_amyloid_combine, "data_mci/combined_mci_amyloid.csv")
```
